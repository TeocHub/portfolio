<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporteros de la Democracia - Tu Misi√≥n como Periodista</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0051a8;
            --secondary-color: #e31e24;
            --accent-color: #f5f5f5;
            --text-color: #333;
            --light-blue: #e6f2ff;
            --success-green: #28a745;
            --warning-yellow: #ffc107;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            background-color: #f9f9f9;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .step-container {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .step-container.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 5px solid var(--primary-color);
        }
        
        .reference-box {
            background-color: #eef7ff;
            border: 1px dashed #0051a8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .reference-box h5 {
            color: var(--primary-color);
            font-weight: bold;
        }

        .example-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .example-box h5 {
            color: var(--primary-color);
            font-weight: bold;
        }

        .power-box {
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .power-legislativo { background-color: var(--light-blue); border-left: 5px solid var(--primary-color); }
        .power-ejecutivo { background-color: #fff0e6; border-left: 5px solid #ff7f00; }
        .power-judicial { background-color: #e6ffe6; border-left: 5px solid #00a000; }
        .power-ciudadano { background-color: #f0e6ff; border-left: 5px solid #7f00ff; }
        
        .sticky-note {
            background-color: #fff8c4;
            padding: 1rem;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            margin: 0.5rem;
            display: inline-block;
            min-width: 180px;
            font-style: italic;
        }
        
        .news-headline {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }
        
        .news-lead {
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .btn-primary { background-color: var(--primary-color); border-color: var(--primary-color); }
        .btn-secondary { background-color: #6c757d; border-color: #6c757d; }
        .btn-success { background-color: var(--success-green); border-color: var(--success-green); }

        .progress-container {
            background-color: #e9ecef;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
            position: sticky;
            top: 20px;
            z-index: 10;
        }

        .progress-step {
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
        }
        .progress-step.active {
            color: var(--primary-color);
            font-weight: bold;
        }
        .progress-step.completed {
            color: var(--success-green);
        }


        .final-news-preview {
            border: 1px solid #ddd;
            padding: 2rem;
            background-color: white;
            margin-top: 2rem;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container text-center">
            <h1 class="display-4 fw-bold">üì∞ Reporteros de la Democracia</h1>
            <p class="lead">Tu Misi√≥n: Crear una noticia que muestre c√≥mo Chile resuelve sus problemas.</p>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="container">
        <div class="progress-container">
            <div class="row text-center">
                <div class="col progress-step completed" id="progress-step-1">
                    <i class="fas fa-check-circle fa-2x"></i>
                    <p>1. Inicio</p>
                </div>
                <div class="col progress-step" id="progress-step-2">
                    <i class="fas fa-circle fa-2x"></i>
                    <p>2. Herramientas</p>
                </div>
                <div class="col progress-step" id="progress-step-3">
                    <i class="fas fa-circle fa-2x"></i>
                    <p>3. Borrador</p>
                </div>
                <div class="col progress-step" id="progress-step-4">
                    <i class="fas fa-circle fa-2x"></i>
                    <p>4. Final</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container my-5">
        
        <!-- OBJETIVOS DE APRENDIZAJE -->
        <div class="section-card" style="background-color: #e6f2ff; border-left: 5px solid var(--primary-color);">
            <h3 style="color: var(--primary-color); margin-bottom: 1.5rem;">
                <i class="fas fa-book"></i> Historia - 6to B√°sico
            </h3>
            <p style="margin-bottom: 1rem;"><strong>Objetivo: Explicar algunos elementos fundamentales de la organizaci√≥n democr√°tica de Chile, incluyendo:</strong></p>
            <ul style="margin-left: 1.5rem;">
                <li>La divisi√≥n de poderes del Estado</li>
                <li>La representaci√≥n a trav√©s de cargos de elecci√≥n popular (concejales, alcaldes, diputados, senadores y Presidente)</li>
                <li>La importancia de la participaci√≥n ciudadana</li>
            </ul>
        </div>
        
        <!-- PASO 1: INICIO -->
        <div id="step1" class="step-container active">
            <section class="section-card">
                <h2 class="mb-4">üé§ Paso 1: Entendiendo el Periodismo y el Problema</h2>
                <p><strong>Tu misi√≥n aqu√≠:</strong> Aprender las partes de una noticia y elegir un problema real de Chile para tu reportaje.</p>
                
                <h4 class="mt-4">A. Los Elementos Clave de una Noticia</h4>
                <p>Toda buena noticia responde a seis preguntas clave: Qu√©, Qui√©n, Cu√°ndo, D√≥nde, Por qu√© y C√≥mo. Mira este ejemplo real:</p>
                
                <div class="example-box">
                    <h5><i class="fas fa-newspaper"></i> Noticia de Ejemplo: "Nueva ley de reciclaje busca reducir basura en las costas"</h5>
                    <ul>
                        <li><strong>QU√â:</strong> Se promulg√≥ una nueva ley de reciclaje.</li>
                        <li><strong>QUI√âN:</strong> El Presidente Gabriel Boric (Ejecutivo) y el Congreso Nacional (Legislativo), impulsado por comunidades costeras (Ciudadanos).</li>
                        <li><strong>CU√ÅNDO:</strong> Ayer, en una ceremonia en La Moneda.</li>
                        <li><strong>D√ìNDE:</strong> A nivel nacional, con √©nfasis en las costas chilenas.</li>
                        <li><strong>POR QU√â:</strong> Para responder a la creciente contaminaci√≥n marina y la demanda de organizaciones ambientalistas.</li>
                        <li><strong>C√ìMO:</strong> Los ciudadanos protestaron y presentaron propuestas ‚Üí El Congreso <strong>legisl√≥</strong> y aprob√≥ la ley ‚Üí El Presidente la <strong>promulg√≥</strong> (ejecut√≥).</li>
                    </ul>
                </div>
                <p class="text-muted"><em>Como ves, el "Qui√©n" y el "C√≥mo" son clave para entender la democracia en acci√≥n.</em></p>

                <hr>

                <h4 class="mt-4">B. Lluvia de Ideas: ¬øQu√© problema resolveremos?</h4>
                <p>Una buena noticia trata de un problema real. Aqu√≠ hay algunos ejemplos de temas que afectan a Chile. Elige uno que te interese o escribe el tuyo.</p>
                
                <div class="d-flex flex-wrap justify-content-center">
                    <div class="sticky-note">Falta de agua en zonas rurales</div>
                    <div class="sticky-note">Contaminaci√≥n del aire en Santiago</div>
                    <div class="sticky-note">Inseguridad y delito en tu comuna</div>
                    <div class="sticky-note">Colapso del transporte p√∫blico</div>
                    <div class="sticky-note">Problemas con la basura en la playa</div>
                    <div class="sticky-note">Necesidad de m√°s plazas y parques</div>
                </div>

                <div class="mt-4 p-3 bg-light rounded">
                    <label for="chosenProblem" class="form-label"><strong>Problema que tu grupo elegir√° para la noticia:</strong></label>
                    <textarea class="form-control" id="chosenProblem" rows="2" placeholder="Escribe aqu√≠ el problema seleccionado..." oninput="saveData()"></textarea>
                </div>

                <div class="text-end mt-4">
                    <button class="btn btn-primary btn-lg" onclick="nextStep(2)">
                        Siguiente: Herramientas Democr√°ticas <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </section>
        </div>

        <!-- PASO 2: DESARROLLO I -->
        <div id="step2" class="step-container">
            <section class="section-card">
                <h2 class="mb-4">üõ†Ô∏è Paso 2: Tu Caja de Herramientas Democr√°ticas</h2>
                <p><strong>Tu misi√≥n aqu√≠:</strong> Conocer a los "actores" de la democracia y sus funciones para que puedas usarlos correctamente en tu noticia.</p>
                
                <!-- Reference Box -->
                <div class="reference-box">
                    <h5><i class="fas fa-lightbulb"></i> No olvides tu tema</h5>
                    <p id="ref-problem">Tu problema seleccionado aparecer√° aqu√≠.</p>
                </div>
                
                <h4 class="mt-4">A. Los Tres Poderes del Estado</h4>
                <p>En Chile, el poder est√° dividido para evitar abusos. Cada poder tiene una funci√≥n principal.</p>
                
                <div class="power-box power-legislativo">
                    <h4><i class="fas fa-gavel"></i> FUNCI√ìN: LEGISLAR (Poder Legislativo)</h4>
                    <p><strong>Actores Clave:</strong> Diputados, Senadores, Concejales.</p>
                    <p><strong>Su Trabajo:</strong> Crear, debatir y aprobar leyes. Fiscalizar al Ejecutivo.</p>
                    <div class="example-box">
                        <h5><i class="fas fa-quote-left"></i> En una noticia se lee as√≠...</h5>
                        <p>"El Senado <strong>aprob√≥</strong> ayer la ley que permite el retiro del 10% de los fondos de pensiones, tras una larga sesi√≥n..."</p>
                    </div>
                </div>
                
                <div class="power-box power-ejecutivo">
                    <h4><i class="fas fa-landmark"></i> FUNCI√ìN: EJECUTAR (Poder Ejecutivo)</h4>
                    <p><strong>Actores Clave:</strong> Presidente, Ministros, Alcaldes, Seremis.</p>
                    <p><strong>Su Trabajo:</strong> Cumplir y hacer cumplir las leyes. Administrar el pa√≠s. Proponer nuevas leyes.</p>
                    <div class="example-box">
                        <h5><i class="fas fa-quote-left"></i> En una noticia se lee as√≠...</h5>
                        <p>"La Presidenta de la Rep√∫blica, Michelle Bachelet, <strong>anunci√≥</strong> un nuevo plan de obras p√∫blicas para mejorar la conectividad en la Araucan√≠a..."</p>
                    </div>
                </div>
                
                <div class="power-box power-judicial">
                    <h4><i class="fas fa-balance-scale"></i> FUNCI√ìN: JUZGAR (Poder Judicial)</h4>
                    <p><strong>Actores Clave:</strong> Jueces, Cortes de Apelaciones, Corte Suprema.</p>
                    <p><strong>Su Trabajo:</strong> Interpretar las leyes y resolver conflictos. Asegurar que todos act√∫en dentro de la ley.</p>
                    <div class="example-box">
                        <h5><i class="fas fa-quote-left"></i> En una noticia se lee as√≠...</h5>
                        <p>"La Corte Suprema <strong>fall√≥</strong> a favor de los trabajadores, determinando que el despido fue injustificado y por tanto ilegal..."</p>
                    </div>
                </div>

                <hr>

                <h4 class="mt-4">B. El Actor M√°s Importante: La Ciudadan√≠a</h4>
                <p>La democracia no funciona sin la gente. Los ciudadanos son el motor del cambio.</p>
                
                <div class="power-box power-ciudadano">
                    <h4><i class="fas fa-users"></i> PARTICIPACI√ìN CIUDADANA</h4>
                    <p><strong>Actores Clave:</strong> T√∫, tu familia, tus vecinos, las organizaciones sociales.</p>
                    <p><strong>Su Trabajo:</strong> Votar, protestar pac√≠ficamente, organizarse, proponer ideas, fiscalizar a las autoridades.</p>
                    <div class="example-box">
                        <h5><i class="fas fa-quote-left"></i> En una noticia se lee as√≠...</h5>
                        <p>"Vecinos de Maip√∫ <strong>recolectaron m√°s de 10 mil firmas</strong> para exigir la construcci√≥n de un nuevo consultorio, logrando que el alcalde incluyera el proyecto en el presupuesto municipal..."</p>
                    </div>
                </div>

                <div class="text-end mt-4">
                    <button class="btn btn-secondary btn-lg me-2" onclick="nextStep(1)">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn btn-primary btn-lg" onclick="nextStep(3)">
                        Siguiente: Escribiendo la Noticia <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </section>
        </div>

        <!-- PASO 3: DESARROLLO II -->
        <div id="step3" class="step-container">
            <section class="section-card">
                <h2 class="mb-4">‚úçÔ∏è Paso 3: ¬°Manos a la Obra! Creando tu Noticia</h2>
                <p><strong>Tu misi√≥n aqu√≠:</strong> Usar todo lo que aprendiste para construir el borrador de tu noticia, conectando el problema con la soluci√≥n democr√°tica.</p>
                
                <!-- Reference Box -->
                <div class="reference-box">
                    <h5><i class="fas fa-lightbulb"></i> Tu tema a resolver</h5>
                    <p id="ref-problem-3">Tu problema seleccionado aparecer√° aqu√≠.</p>
                </div>
                
                <h4 class="mt-4">A. Define el Escenario de la Soluci√≥n</h4>
                <p>Recuerda el problema que elegiste. Ahora, imagina c√≥mo se resolver√≠a. Una buena historia democr√°tica siempre involucra a los ciudadanos.</p>
                
                <div class="example-box">
                    <h5><i class="fas fa-lightbulb"></i> Ejemplo de Escenario (Problema: Basura en la playa)</h5>
                    <p><strong>1. Acci√≥n Ciudadana:</strong> Un grupo de surfistas y vecinos de la costanera se organiza a trav√©s de redes sociales. Cansados de ver la playa sucia, <strong>lanzan una campa√±a</strong> para limpiarla y exigir una soluci√≥n permanente. Juntan firmas.</p>
                    <p><strong>2. Acci√≥n Legislativa:</strong> Un concejal del municipio, apoyado por la comunidad, <strong>presenta una ordenanza municipal</strong> para prohibir el uso de pl√°sticos de un solo uso en los comercios de la costa.</p>
                    <p><strong>3. Acci√≥n Ejecutiva:</strong> El alcalde, presionado por la campa√±a y la nueva ordenanza, <strong>ejecuta un plan</strong> que incluye m√°s basureros, personal de limpieza y campa√±as educativas en las escuelas locales.</p>
                </div>

                <div class="mt-4 p-3 bg-light rounded">
                    <label for="scenario" class="form-label"><strong>Escribe el escenario de tu noticia:</strong> (¬øC√≥mo inician los ciudadanos? ¬øQu√© hace el poder legislativo? ¬øQu√© ejecuta el poder ejecutivo?)</label>
                    <textarea class="form-control" id="scenario" rows="5" placeholder="Describe la secuencia de eventos que resuelve tu problema..." oninput="saveData()"></textarea>
                </div>

                <hr>

                <h4 class="mt-4">B. Responde las Seis Preguntas Clave para tu Noticia</h4>
                <p>Ahora, llena los datos de tu propia noticia usando la plantilla.</p>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Pregunta Clave</th>
                                <th>Tu Respuesta (Usa lenguaje democr√°tico)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>QU√â</strong></td>
                                <td><input type="text" class="form-control" id="news-what" placeholder="Ej: Se aprob√≥ una nueva ordenanza de limpieza..." oninput="saveData()"></td>
                            </tr>
                            <tr>
                                <td><strong>QUI√âN</strong></td>
                                <td><input type="text" class="form-control" id="news-who" placeholder="Ej: Los vecinos, el Concejal y el Alcalde..." oninput="saveData()"></td>
                            </tr>
                            <tr>
                                <td><strong>CU√ÅNDO</strong></td>
                                <td><input type="text" class="form-control" id="news-when" placeholder="Ej: Esta ma√±ana, en el Concejo Municipal..." oninput="saveData()"></td>
                            </tr>
                            <tr>
                                <td><strong>D√ìNDE</strong></td>
                                <td><input type="text" class="form-control" id="news-where" placeholder="Ej: En la comuna de Re√±aca..." oninput="saveData()"></td>
                            </tr>
                            <tr>
                                <td><strong>POR QU√â</strong></td>
                                <td><input type="text" class="form-control" id="news-why" placeholder="Ej: Por la creciente contaminaci√≥n de la playa..." oninput="saveData()"></td>
                            </tr>
                            <tr>
                                <td><strong>C√ìMO</strong></td>
                                <td><input type="text" class="form-control" id="news-how" placeholder="Ej: Los ciudadanos presionaron, el Concejal legisl√≥ y el Alcalde ejecut√≥..." oninput="saveData()"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="text-end mt-4">
                    <button class="btn btn-secondary btn-lg me-2" onclick="nextStep(2)">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn btn-primary btn-lg" onclick="nextStep(4)">
                        Siguiente: Tu Noticia Final <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </section>
        </div>

        <!-- PASO 4: CIERRE -->
        <div id="step4" class="step-container">
            <section class="section-card">
                <h2 class="mb-4">üì¢ Paso 4: ¬°Tu Noticia est√° Lista!</h2>
                <p><strong>Tu misi√≥n final:</strong> Redactar un titular y un p√°rrafo principal impactantes, y revisar que tu noticia sea democr√°ticamente correcta.</p>
                
                <!-- Reference Box with all data -->
                <div class="reference-box">
                    <h5><i class="fas fa-clipboard-list"></i> Tu Informaci√≥n Recopilada (Usa esto para escribir)</h5>
                    <p><strong>Problema:</strong> <span id="ref-problem-4">...</span></p>
                    <p><strong>Escenario:</strong> <span id="ref-scenario">...</span></p>
                    <p><strong>QU√â:</strong> <span id="ref-what">...</span></p>
                    <p><strong>QUI√âN:</strong> <span id="ref-who">...</span></p>
                    <p><strong>CU√ÅNDO:</strong> <span id="ref-when">...</span></p>
                    <p><strong>D√ìNDE:</strong> <span id="ref-where">...</span></p>
                    <p><strong>POR QU√â:</strong> <span id="ref-why">...</span></p>
                    <p><strong>C√ìMO:</strong> <span id="ref-how">...</span></p>
                </div>

                <h4 class="mt-4">A. Redacci√≥n Final: Titular y Lead</h4>
                <p>Usa toda la informaci√≥n que recopilaste para escribir la parte m√°s importante de tu noticia. Un buen titular debe ser corto y directo. El p√°rrafo principal (o "lead") debe resumir las 6 Ws.</p>
                
                <div class="mb-3">
                    <label for="final-headline" class="form-label"><strong>TITULAR FINAL:</strong></label>
                    <input type="text" class="form-control" id="final-headline" placeholder="Ej: Ciudadanos de Re√±aca logran ley para salvar sus playas" oninput="saveData()">
                </div>
                
                <div class="mb-3">
                    <label for="final-lead" class="form-label"><strong>P√ÅRRAFO PRINCIPAL (Lead):</strong></label>
                    <textarea class="form-control" rows="4" id="final-lead" placeholder="Ej: Gracias a la movilizaci√≥n de miles de vecinos, esta ma√±ana el Concejal Mart√≠nez logr√≥ aprobar una ordenanza que prohibir√° los pl√°sticos de un solo uso en la comuna. El alcalde P√©rez anunci√≥ la ejecuci√≥n inmediata del plan 'Playa Limpia', que incluye m√°s personal de aseo y campa√±as educativas, respondiendo as√≠ a una demanda ciudadana que llevaba meses exigiendo una soluci√≥n a la creciente contaminaci√≥n." oninput="saveData()"></textarea>
                </div>

                <button class="btn btn-success mb-4" onclick="generatePreview()">
                    <i class="fas fa-eye"></i> Generar Vista Previa de la Noticia
                </button>

                <div id="final-news-preview" class="final-news-preview" style="display: none;">
                    <h3 class="news-headline" id="preview-headline-text"></h3>
                    <p class="news-lead" id="preview-lead-text"></p>
                </div>
                
                <hr>

                <h4 class="mt-4">B. Revisi√≥n Final: ¬øEs Democr√°ticamente Correcta?</h4>
                <p>Antes de publicar, aseg√∫rate de que tu noticia no tenga errores. Revisa estos puntos:</p>
                
                <div class="example-box">
                    <h5><i class="fas fa-check-circle text-success"></i> Ejemplo Correcto:</h5>
                    <p>"El <strong>Alcalde</strong> <strong>ejecut√≥</strong> el plan de seguridad tras la <strong>protesta</strong> de los vecinos."</p>
                    <p class="text-success"><em>‚úÖ Correcto: El alcalde ejecuta, los ciudadanos participan.</em></p>
                </div>
                
                <div class="example-box">
                    <h5><i class="fas fa-times-circle text-danger"></i> Ejemplo Incorrecto:</h5>
                    <p>"El <strong>Juez</strong> <strong>construy√≥</strong> un nuevo hospital para la comunidad."</p>
                    <p class="text-danger"><em>‚ùå Incorrecto: Un juez juzga, no ejecuta obras. Eso es funci√≥n del Alcalde o Presidente.</em></p>
                </div>

                <div class="mt-5 p-4 bg-light rounded" style="border: 2px solid var(--primary-color);">
                    <h5 style="color: var(--primary-color); margin-bottom: 2rem;">
                        <i class="fas fa-lightbulb"></i> Pregunta de Cierre para Reflexionar
                    </h5>
                    
                    <div style="background-color: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid var(--secondary-color);">
                        <p style="font-size: 1.1rem; font-weight: 500; line-height: 1.8; margin: 0;">
                            "¬øPor qu√© si no hubi√©ramos incluido a los Ciudadanos (Participaci√≥n) nuestra noticia no ser√≠a una historia completa?"
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 2rem;">
                        <button class="btn btn-outline-primary" onclick="toggleAnswer(event)" style="width: 100%; padding: 0.75rem;">
                            <i class="fas fa-eye"></i> Ver Respuesta de Ejemplo
                        </button>
                        <div id="answerExample" style="display: none; margin-top: 1rem; padding: 1rem; background-color: #e6f2ff; border-radius: 5px; border-left: 4px solid var(--primary-color);">
                            <p style="margin: 0; font-style: italic;">
                                "Porque la democracia se trata de representar la voluntad de la gente. Sin los ciudadanos, no hay democracia."
                            </p>
                        </div>
                    </div>

                    <hr style="margin: 2rem 0;">

                    <p style="color: var(--primary-color); font-weight: bold; margin-bottom: 1rem;">
                        <i class="fas fa-pen"></i> Ahora, escribe TU respuesta:
                    </p>
                    <textarea class="form-control" id="studentAnswer" rows="4" placeholder="Reflexiona: ¬øPor qu√© crees que los ciudadanos son importantes para una historia completa? Escribe tu propia respuesta..." oninput="saveData()" style="margin-bottom: 1.5rem;"></textarea>
                    
                    <p style="font-size: 0.9rem; color: #666; text-align: center;">
                        <i class="fas fa-info-circle"></i> Tu respuesta se incluir√° en el PDF que descargar√°s.
                    </p>
                </div>

                <div class="text-center mt-5">
                    <h3>¬°Felicidades, Reportero!</h3>
                    <p>Has completado tu misi√≥n. Ahora sabes c√≥mo funciona la democracia y c√≥mo contar una noticia que lo demuestre.</p>
                    <button class="btn btn-primary btn-lg" onclick="downloadNews()">
                        <i class="fas fa-download"></i> Descargar tu Noticia en PDF
                    </button>
                </div>
                
                <div class="text-end mt-4">
                    <button class="btn btn-secondary btn-lg" onclick="nextStep(3)">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                </div>
            </section>
        </div>

    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let currentStep = 1;
        let newsData = {
            problem: '',
            scenario: '',
            what: '',
            who: '',
            when: '',
            where: '',
            why: '',
            how: '',
            finalHeadline: '',
            finalLead: '',
            studentAnswer: ''
        };

        function saveData() {
            newsData.problem = document.getElementById('chosenProblem').value;
            newsData.scenario = document.getElementById('scenario').value;
            newsData.what = document.getElementById('news-what').value;
            newsData.who = document.getElementById('news-who').value;
            newsData.when = document.getElementById('news-when').value;
            newsData.where = document.getElementById('news-where').value;
            newsData.why = document.getElementById('news-why').value;
            newsData.how = document.getElementById('news-how').value;
            newsData.finalHeadline = document.getElementById('final-headline').value;
            newsData.finalLead = document.getElementById('final-lead').value;
            const studentAnswerField = document.getElementById('studentAnswer');
            if (studentAnswerField) {
                newsData.studentAnswer = studentAnswerField.value;
            }
        }

        function toggleAnswer(event) {
            event.preventDefault();
            const answerDiv = document.getElementById('answerExample');
            const button = event.target.closest('button');
            
            if (answerDiv.style.display === 'none') {
                answerDiv.style.display = 'block';
                button.innerHTML = '<i class="fas fa-eye-slash"></i> Ocultar Respuesta de Ejemplo';
            } else {
                answerDiv.style.display = 'none';
                button.innerHTML = '<i class="fas fa-eye"></i> Ver Respuesta de Ejemplo';
            }
        }

        function showStep(step) {
            document.querySelectorAll('.step-container').forEach(container => {
                container.classList.remove('active');
            });
            document.getElementById(`step${step}`).classList.add('active');

            // Update progress bar
            for (let i = 1; i <= 4; i++) {
                const progressStep = document.getElementById(`progress-step-${i}`);
                progressStep.classList.remove('active', 'completed');
                if (i < step) {
                    progressStep.classList.add('completed');
                    progressStep.innerHTML = `<i class="fas fa-check-circle fa-2x"></i><p>${i}. ${getStepName(i)}</p>`;
                } else if (i === step) {
                    progressStep.classList.add('active');
                    progressStep.innerHTML = `<i class="fas fa-circle fa-2x"></i><p>${i}. ${getStepName(i)}</p>`;
                } else {
                    progressStep.innerHTML = `<i class="far fa-circle fa-2x"></i><p>${i}. ${getStepName(i)}</p>`;
                }
            }
            window.scrollTo(0, 0);
        }
        
        function getStepName(step) {
            const names = ['', 'Inicio', 'Herramientas', 'Borrador', 'Final'];
            return names[step];
        }

        function validateStep(fromStep) {
            // Validate required fields before moving to next step
            if (fromStep === 1) {
                const problem = document.getElementById('chosenProblem').value.trim();
                if (!problem) {
                    alert('‚ö†Ô∏è Por favor, completa el campo "Problema que tu grupo elegir√° para la noticia" antes de continuar.');
                    return false;
                }
            }
            if (fromStep === 3) {
                const scenario = document.getElementById('scenario').value.trim();
                const what = document.getElementById('news-what').value.trim();
                const who = document.getElementById('news-who').value.trim();
                const when = document.getElementById('news-when').value.trim();
                const where = document.getElementById('news-where').value.trim();
                const why = document.getElementById('news-why').value.trim();
                const how = document.getElementById('news-how').value.trim();
                
                if (!scenario || !what || !who || !when || !where || !why || !how) {
                    alert('‚ö†Ô∏è Por favor, completa todos los campos de la noticia antes de continuar:\n- Escenario de la noticia\n- QU√â\n- QUI√âN\n- CU√ÅNDO\n- D√ìNDE\n- POR QU√â\n- C√ìMO');
                    return false;
                }
            }
            return true;
        }

        function nextStep(step) {
            // Validate current step before moving
            if (!validateStep(currentStep)) {
                return;
            }
            
            saveData(); // Save current data before moving
            currentStep = step;
            showStep(step);
            
            // Populate reference boxes when moving to a new step
            if (step === 2) {
                document.getElementById('ref-problem').textContent = newsData.problem || '(A√∫n no se ha seleccionado un problema)';
            }
            if (step === 3) {
                document.getElementById('ref-problem-3').textContent = newsData.problem || '(A√∫n no se ha seleccionado un problema)';
            }
            if (step === 4) {
                document.getElementById('ref-problem-4').textContent = newsData.problem || '...';
                document.getElementById('ref-scenario').textContent = newsData.scenario || '...';
                document.getElementById('ref-what').textContent = newsData.what || '...';
                document.getElementById('ref-who').textContent = newsData.who || '...';
                document.getElementById('ref-when').textContent = newsData.when || '...';
                document.getElementById('ref-where').textContent = newsData.where || '...';
                document.getElementById('ref-why').textContent = newsData.why || '...';
                document.getElementById('ref-how').textContent = newsData.how || '...';
            }
        }
        
        function generatePreview() {
            const headline = document.getElementById('final-headline').value;
            const lead = document.getElementById('final-lead').value;

            if (headline && lead) {
                document.getElementById('preview-headline-text').textContent = headline;
                document.getElementById('preview-lead-text').textContent = lead;
                document.getElementById('final-news-preview').style.display = 'block';
            } else {
                alert('Por favor, completa tanto el titular como el p√°rrafo principal para generar la vista previa.');
            }
        }

        function downloadNews() {
            // Validate that all required fields are filled
            const headline = document.getElementById('final-headline').value.trim();
            const lead = document.getElementById('final-lead').value.trim();
            const studentAnswer = document.getElementById('studentAnswer').value.trim();
            
            if (!headline || !lead || !studentAnswer) {
                alert('‚ö†Ô∏è Por favor, completa todos los campos antes de descargar:\n- TITULAR FINAL\n- P√ÅRRAFO PRINCIPAL (Lead)\n- Tu respuesta de reflexi√≥n personal');
                return;
            }
            
            saveData(); // Ensure the latest data is saved
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(20);
            doc.text('Reportero de la Democracia: Mi Noticia', 20, 20);
            
            doc.setFontSize(16);
            doc.text('TITULAR:', 20, 40);
            doc.setFontSize(14);
            doc.text(newsData.finalHeadline, 20, 50);

            doc.setFontSize(16);
            doc.text('P√ÅRRAFO PRINCIPAL:', 20, 70);
            doc.setFontSize(12);
            const splitLead = doc.splitTextToSize(newsData.finalLead, 170);
            doc.text(splitLead, 20, 80);

            doc.addPage();
            doc.setFontSize(16);
            doc.text('DETALLES DE LA INVESTIGACI√ìN', 20, 20);
            
            doc.setFontSize(14);
            doc.text('Problema Abordado:', 20, 40);
            doc.setFontSize(12);
            doc.text(newsData.problem, 20, 50);

            doc.setFontSize(14);
            doc.text('Escenario de Soluci√≥n:', 20, 70);
            doc.setFontSize(12);
            const splitScenario = doc.splitTextToSize(newsData.scenario, 170);
            doc.text(splitScenario, 20, 80);

            doc.setFontSize(14);
            doc.text('Los Elementos Clave de la Noticia:', 20, 120);
            doc.setFontSize(12);
            doc.text(`QU√â: ${newsData.what}`, 20, 130);
            doc.text(`QUI√âN: ${newsData.who}`, 20, 140);
            doc.text(`CU√ÅNDO: ${newsData.when}`, 20, 150);
            doc.text(`D√ìNDE: ${newsData.where}`, 20, 160);
            doc.text(`POR QU√â: ${newsData.why}`, 20, 170);
            doc.text(`C√ìMO: ${newsData.how}`, 20, 180);

            doc.addPage();
            doc.setFontSize(16);
            doc.text('Mi Reflexi√≥n: Respuesta Personal', 20, 20);
            
            doc.setFontSize(14);
            doc.text('Pregunta: ¬øPor qu√© si no hubi√©ramos incluido a los', 20, 40);
            doc.text('Ciudadanos (Participaci√≥n) nuestra noticia no ser√≠a', 20, 48);
            doc.text('una historia completa?', 20, 56);
            
            doc.setFontSize(12);
            const splitAnswer = doc.splitTextToSize(newsData.studentAnswer || '(Sin respuesta)', 170);
            doc.text(splitAnswer, 20, 70);

            doc.save('mi_noticia_democracia.pdf');
        }
    </script>
</body>
</html>